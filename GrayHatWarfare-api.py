import json
import requests
from datetime import date
import sys
import csv
import os
import pandas as pd
from colorama import init, Fore, Back, Style
init(autoreset=True)

idlist =[]
bucketlist=[]
urllist=[]
typelist=[]

def usage():
	print("")
	print(Fore.BLUE + "="*25 +Fore.GREEN +  "  GREYHATWARFARE PARSER  " + Fore.BLUE + "="*25)
	print("[+] Usage : python3 script.py <word_to_search> <wished extension>")
	print("")
	print("")
	
def get_results_number(api_url):
	response = requests.get(api_url)
	data = json.loads(response.text)
	result_number = data['results']
	return result_number
	
def createfile_name(word):
	today = date.today()
	jsonfile = str(today)+'-'+str(word)+"-bucket.json"
	return jsonfile

def do_requests(results_number,filename,word,ext):
	print("")
	print(Fore.BLUE + "="*25 + Fore.GREEN + "Starting requests" + Fore.BLUE + "="*25)
	print("[+] Results number: " + str(results_number))
	quotien = results_number // 1000
	i = 0
	while i < quotien + 1:
		api_request = "https://buckets.grayhatwarfare.com/api/v1/files/"+word+"/"+str(i)+"000/1000?extensions="+ext+"&access_token=a963b2a66d6da00ab89c16e7136e6297"
		fulljsonname = str(i)+"-"+filename
		response = requests.get(api_request)
		print("[+] Requests..." + str(i)+ "/"+str(quotien))
		with open(fulljsonname,"a") as jsonfile:
			jsonfile.write(response.text)
		jsonfile.close()
		i=i+1

def main():
	try:
		word = str(sys.argv[1])
		ext = str(sys.argv[2])
		api_url = "https://buckets.grayhatwarfare.com/api/v1/files/"+word+"/0/1?extensions="+ext+"&access_token=a963b2a66d6da00ab89c16e7136e6297"
		print ("[+] request: " + api_url)
		print(Fore.BLUE + "="*25 +Fore.GREEN +  "  GREYHATWARFARE PARSER  " + Fore.BLUE + "="*25)
		print("")
		do_requests(get_results_number(api_url),createfile_name(word),word,ext)
	except Exception as e:
		print(e)
		usage()
  
if __name__=="__main__":
    main()
